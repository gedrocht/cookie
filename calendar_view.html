<html>
<head>
<style>
body {
    background-color:#f5f5f5;
}

div {
    margin: 0px;
    padding: 0px;
    width: 100%;
    line-height: 2;
    text-shadow: none;
}

div.dateOverlay {
    position: absolute;
    font-weight: bold;
    font-size: 24;
    margin-top: -69px;
    width: 491px;
    text-align: right;
    left: auto;
    z-index: 99999;
    opacity: 0.666;
    
    -webkit-background-clip: text;
    -moz-background-clip: text;
    background-clip: text;
}

div.dateOverlay-Monday {
    color: rgba(68,109,150,0.999);
    text-shadow: 0px 1px 1px rgba(102,165,226,0.9);
}

div.dateOverlay-Tuesday {
    color: rgba(68,150,109,0.999);
    text-shadow: 0px 1px 1px rgba(102,226,165,0.9);
}

div.dateOverlay-Wednesday {
    color: rgba(150,68,109,0.999);
    text-shadow: 0px 1px 1px rgba(226,102,165,0.9);
}

div.dateOverlay-Thursday {
    color: rgba(150,109,68,0.999);
    text-shadow: 0px 1px 1px rgba(226,165,102,0.9);
}

div.dateOverlay-Friday {
    color: rgba(108,68,136,0.999);
    text-shadow: 0px 1px 1px rgba(165,102,206,0.9);
}

div.dateOverlay-Saturday {
    color: rgba(95,150,68,0.999);
    text-shadow: 0px 1px 1px rgba(144,226,103,0.9);
}

div.dateOverlay-Sunday {
    color: rgba(109,109,150,0.999);
    text-shadow: 0px 1px 1px rgba(165,165,226,0.9);
}

div.day {
    border: 1px black solid;
    width: 491px;
    color: #f0f0f0;
    margin-left: auto;
    margin-right: auto;
    font-family: Arial;
    float: none;
    padding-left: 10px;
    padding-right: 10px;
    padding-top: 10px;
    padding-bottom: 0px;
    margin-top: 8px;
    margin-bottom: 8px;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.66);
    box-shadow: 2px 2px 9px 1px rgba(0,0,0,0.4);
}

div.Monday {
    background-color: #58b;
}

div.Tuesday {
    background-color: #5b8;
}

div.Wednesday {
    background-color: #b58;
}

div.Thursday {
    background-color: #b85;
}

div.Friday {
    background-color: #85a;
}

div.Saturday {
    background-color: #7b5;
}

div.Sunday {
    background-color: #88b;
}

div.eventRow {
    padding-left: 10px;
    padding-right: 10px;
    margin-left: -10px;
    margin-top: 0px;
    margin-bottom: 0px;
    float: left;
    color: #000;
    position: relative;
    z-index: 9;
}
div.eventRow:hover {
    z-index: 999;
}

/*rgb(206, 206, 206);*/
div.eventRow-movie-Monday{
    /*background-color: rgb(85,136,187);*/
    /*background-color: rgb(146,171,197);*/
    /*background-color: rgb(176,189,202);*/
    background-color: rgb(184,194,203);
    background: url(tile_Monday.png);
    background-position: 1px 0px;
    /*background-color: rgb(191,198,204);*/
}

div.eventRow-movie-Tuesday{
    /*background-color: rgb(85,187,136);*/
    /*background-color: rgb(146,197,171);*/
    /*background-color: rgb(176,202,189);*/
    background-color: rgb(184,203,194);
    background: url(tile_Tuesday.png);
    background-position: 1px 0px;
    /*background-color: rgb(191,204,198);*/
}

div.eventRow-movie-Wednesday{
    /*background-color: rgb(187,85,136);*/
    /*background-color: rgb(197,146,171);*/
    /*background-color: rgb(202,176,189);*/
    background-color: rgb(203,184,194);
    background: url(tile_Wednesday.png);
    background-position: 1px 0px;
    /*background-color: rgb(204,191,198);*/
}

div.eventRow-movie-Thursday{
    /*background-color: rgb(187,136,85);*/
    /*background-color: rgb(197,171,146);*/
    /*background-color: rgb(202,189,176);*/
    background-color: rgb(203,194,184);
    background: url(tile_Thursday.png);
    background-position: 1px 0px;
    /*background-color: rgb(204,198,191);*/
}

div.eventRow-movie-Friday{
    /*background-color: rgb(136,85,170);*/
    /*background-color: rgb(171,146,188);*/
    /*background-color: rgb(189,176,197);*/
    background-color: rgb(194,184,200);
    background: url(tile_Friday.png);
    background-position: 1px 0px;
    /*background-color: rgb(198,191,202);*/
}

div.eventRow-movie-Saturday{
    /*background-color: rgb(119,187,85);*/
    /*background-color: rgb(163,197,146);*/
    /*background-color: rgb(185,202,176);*/
    background-color: rgb(191,203,184);
    background: url(tile_Saturday.png);
    background-position: 1px 0px;
    /*background-color: rgb(196,204,191);*/
}

div.eventRow-movie-Sunday{
    /*background-color: rgb(136,136,187);*/
    /*background-color: rgb(171,171,197);*/
    /*background-color: rgb(189,189,202);*/
    background-color: rgb(194,194,203);
    background: url(tile_Sunday.png);
    background-position: 1px 0px;
    /*background-color: rgb(198,198,204);*/
}

div.eventRow-game {
    color: #000;
    background-color: #afafaf;
    background-image: url(tile.png);
    text-shadow: 0px 1px 1px rgba(0,0,0,0.15);
}

div.eventRow-unscheduled {
    color: #ddd;
    background-color: #333;
    border-top: 0px solid #333333;
    border-bottom: 0px solid #333333;
}
div.eventRow-unscheduled:hover {
    border-top: 0px solid #00f;
    border-bottom: 0px solid #00f;
}

div.eventRow-even {
    background-color: #cecece;
    border-top: 0px solid #cecece;
    border-bottom: 0px solid #cecece;
}
div.eventRow-even:hover{
    border-top: 0px solid #cecece;
    border-bottom: 0px solid #cecece;
}

div.eventRow-odd {
    background-color: #e5e5e5;
    border-top: 0px solid #e5e5e5;
    border-bottom: 0px solid #e5e5e5;
}
div.eventRow-odd:hover {
    border-top: 0px solid #0000ff;
    border-bottom: 0px solid #0000ff;
}

p {
    margin: 0px;
    padding: 0px;
    padding-top: 0px;
}

div.rating {
    position: absolute;
    width: 295px;
    text-align:right;
    left: auto;
    font-family:  'Lucida Console';
    float: left;
    margin-left: 11px;
    opacity: 0.5;
    font-size: 13px;
    margin-top: 4px;
    color: #777;
    text-shadow: 0px 0px 1px rgba(255,255,255,1);
}

div.rating-Movie {
    opacity: 0.58;
    font-weight: bold;
}

div.rating-Movie-Monday {
    color: rgba(68,109,150,0.999);
}

div.rating-Movie-Tuesday {
    color: rgba(68,150,109,0.999);
}

div.rating-Movie-Wednesday {
    color: rgba(150,68,109,0.999);
}

div.rating-Movie-Thursday {
    color: rgba(150,109,68,0.999);
}

div.rating-Movie-Friday {
    color: rgba(108,68,136,0.999);
}

div.rating-Movie-Saturday {
    color: rgba(95,125,68,0.999);
}

div.rating-Movie-Sunday {
    color: rgba(109,109,150,0.999);
}

p.eventName {
    float: left;
}

p.date {
    font-weight: bold;
    font-size: 23px;
    margin-bottom: 7px;
}

p.eventRange {
    font-family:  'Lucida Console';
    text-shadow: 1px 1px 1px rgba(0,0,0,0.05);
    text-align: right;
    font-size: 12pt;
    float:right;
}

p.eventRange-game {
    text-shadow: 0px 1px 1px rgba(0,0,0,0.1);
}

a {
    text-decoration:none;
}

a:hover, a:visited, a:link, a:active{
    color: #000;
}

a.game:hover, a.game:visited, a.game:link, a.game:active {
    color: #000;
}
</style>
<title>Schedule</title>
<script src="calendar.js"></script>
<script src="randomGames.js"></script>
<script>
var curGame = 0;

var curDate = getDateString();

var tv_shows = ["Mad Men", "The Walking Dead", "Boardwalk Empire", "The Legend of Korra", "Breaking Bad", "The Office", "30 Rock", "It's Always Sunny in Philadelphia", "Parks and Recreation", "Tim And Eric", "House of Cards", "Arrested Development"];

function init(){
    var r={esult:""};
    schedule.forEach(listDay(r));
    document.body.innerHTML = "<br>" + r.esult;
}

function getDateString(){
    var date = new Date();
    var curMonth = date.getMonth()+1;
    var curDay   = date.getDate();
    var curYear  = date.getUTCFullYear();
    
    var m = zfill(curMonth.toString(),2);
    var d = zfill(curDay.toString(),2);
    var y = curYear.toString();
    
    return m + "/" + d + "/" + y;
}

function zfill( str, num ){
    while( str.length < num ){
        str = "0" + str;
    }
    return str;
}

function addGame( game, dayOfWeek ){
    return formatGame( game, dayOfWeek ) + "<br>\n";
}

var listEvent = function(r,dayOfWeek,offset){
    return function(event,index){
        if( index+offset != 0 )
            return r.esult += "<br>" + formatEvent(event,dayOfWeek,index+offset) + "\n";
        return r.esult += formatEvent(event,dayOfWeek,index+offset) + "\n";
    }
}

function listEvents( dayOfWeek, events, offset ){
    var r={esult:'\n'}
    events.forEach(listEvent(r,dayOfWeek,offset));
    return r.esult + "<br>\n";
}

var listDay = function(r){
    return function(day){
        return r.esult += listDayEvents(day);
    }
}

function getRandomGame(){
    if( curGame == randomGames.length )
        curGame = 0;
    
    return randomGames[curGame++];
}

var daysListed = 0;
function listDayEvents( day ){
    var game = getRandomGame();

    if( isDayBeforeToday(day) )
        return "";
    
    daysListed += 1;
    if( daysListed > 18 )
        return "";
        
    var result = "";
    
    var dayOfWeek = (day.date_morning || day.date_evening).split(" ")[0];
    
    var classes = "day " + dayOfWeek;
    
    if( !isDayToday(day) || (new Date()).getHours() < 8 ){
        if( day.events_morning.length != 0 ){
            result += '<div class="' + classes + '">';
            result += formatDate(day.date_morning);
            result += addGame(game,dayOfWeek);
            result += listEvents(dayOfWeek,day.events_morning,0);
            result += '</div>';
        }
    }
    if( day.events_evening.length != 0 ){
        if( result.length != 0 )
            result += "<br>\n";
        
        result += '<div class="' + classes + '">';
        result += formatDate(day.date_evening);
        result += addGame(game,dayOfWeek);
        result += listEvents(dayOfWeek,day.events_evening,0);
        result += '</div>';
    }
    if( result.length != 0 )
        result += "<br>";
    return result + "\n";
}

function isDayBeforeToday( day ){
    return dateLessThan( getDateFromDay(day), curDate );
}

function isDayToday( day ){
    return dateEqualTo( getDateFromDay(day), curDate );
}

function getDateFromDay( day ){
    return (day.date_morning || day.date_evening).split(" ")[1];
}

function dateLessThan( date_a, date_b ) {
    var a = strToDate(date_a);
    var b = strToDate(date_b);
    
    if( a[2] < b[2] ) return true;
    if( a[2] > b[2] ) return false;
    
    if( a[0] < b[0] ) return true;
    if( a[0] > b[0] ) return false;
    
    if( a[1] < b[1] ) return true;
    
    return false;
}

function dateEqualTo( date_a, date_b ){
    var a = strToDate(date_a);
    var b = strToDate(date_b);
    
    return (a[0] == b[0] && a[1] == b[1] && a[2] == b[2]);
}

function strToDate( str ){
    var split = str.split("/");
    return [split[0],split[1],split[2]];
}

function formatDate( date ){
    return '<p class="date">' + clipDate(date) + '</p>' + getDateOverlay(date);
}

function getDateOverlay( date ){
    var dayOfWeek = date.split(" ")[0];
    return '<div class="dateOverlay dateOverlay-' + dayOfWeek + '">' + cleanDate(date.split(" ")[1]) + '</div>';
}

function cleanDate( dateStr ){
    var split = dateStr.split("/");
    var mStr  = split[0];
    var dStr  = split[1];
    var yStr  = split[2];
    
    if( mStr[0] == "0" )
        mStr = mStr[1];
    if( dStr[0] == "0" )
        dStr = dStr[1];
        
    return mStr + "/" + dStr;
}

function clipDate( date ){
    var split = date.split(" ");
    return split[0] + " " + split[2];
}

function formatEvent( event, dayOfWeek, index ){
    var link = "";
    var linkEnd = "";
    var innerText = "";
    
    if( event.url != undefined ){
        link = '<a target="_blank" href="' + event.url + '">';
        linkEnd = '</a>';
    }
    
    innerText = formatEventName(event.name) +  formatEventRating(event.rating, dayOfWeek, event.name) + linkEnd + " " + formatEventRange(event.start,event.end);
    
    return formatEventRow(dayOfWeek, link + innerText, index) + "\n";
}

function formatEventRating( rating, dayOfWeek, eventName ){
    if( rating == 0 )
        return "";
    var ratingStr = rating.toString();
    if( ratingStr.indexOf(".") == -1 )
        ratingStr += ".0";
    var classes = "rating";
    
    if( isMovie(eventName) )
        classes += " rating-Movie rating-Movie-" + dayOfWeek;
        
    console.log( eventName, isMovie(eventName) );
    
    return '<div class="' + classes + '">' + ratingStr + '</div>';
}


function formatGame( game, dayOfWeek ){
    var name  = game[0];
    var appid = game[1];
    
    if( name.length > 35 ){
        name = name.substr(0,35) + "...";
    }
    
    var result = '<a class="game" href="steam://run/' + appid + '">' + name + '</a>' + formatGameOfTheDay( "[Game of the Day]" );
    
    return formatEventRow( dayOfWeek, result, 1, true ) + '\n';
}

function formatGameOfTheDay( text ){
    return '<p class="eventRange eventRange-game">' + text + '</p>'
}

function formatEventName( name ){
    var nameStr = name.toString();
    if(nameStr == "Watch Tim and Eric Awesome Show, Great Job!")
        nameStr = "Watch Tim And Eric";
    
    return '<p class="eventName">' + clipEventName(nameStr) + '</p>';
}

function clipEventName( name ){
    var split = name.split(" ");
    var newName = "";
    if( split[0] == "Watch" ){
        for( var i = 1 ; i < split.length ; i++ ){
            newName += split[i];
            if( i + 1 != split.length )
                newName += " ";
        }
    } else {
        return name;
    }
    return newName;
}

function formatEventRange( start, end ){
    return '<p class="eventRange">' + start + " - " + end + '</p>'
}

function formatEventRow( dayOfWeek, row, index, isGame ){
    classes = "eventRow";
    if( isGame ){
        classes += " eventRow-game";
    } else {
        if( isMovie(row) ){
            classes += " eventRow-movie-" + dayOfWeek;
        } else {
            if( row.indexOf("UNSCHEDULED") != -1 ){
                classes += " eventRow-unscheduled";
            } else {
                if( index % 2 == 0 )
                    classes += " eventRow-even";
                else
                    classes += " eventRow-odd";
            }
        }
    }
    
    return '<div class="' + classes + '">' + row + '</div>';
}

function isMovie( row ){
    var rowValue = row.toString();
    rowValue = rowValue.replace("Tim and Eric Awesome Show, Great Job!","Tim And Eric");

    if( rowValue.indexOf("UNSCHEDULED") != -1 )
        return false;
        
    console.log("");
    console.log(rowValue, "is not unscheduled");
        
    if( rowValue.indexOf("<") != -1 && rowValue.indexOf('rating') == -1 )
        return false;
        
    console.log(rowValue, "does not contain \"rating\"");
    
    for( var i = 0 ; i < tv_shows.length ; i++ ){
        if( rowValue.indexOf(tv_shows[i]) != -1 ){
            console.log( 'found "' + tv_shows[i] + '" in "' + rowValue + '"' );
            return false;
        }
    }
    
    console.log( rowValue + " is totally a movie" );
    
    return true;
}

function listRatings(){
    var event;
    var day;
    var events = [];
    var eventsListed = [];

    function addEvent( event ){
        if( contains(events, event) )
            return;
        events.push(event);
        //console.log( event.name + "|" + event.rating );
        //moviesToSchedule.append(["Watch Vertigo",128]);
    }
    
    function listEventsInOrder(){
        var event;
        for( var i = 10.0 ; i >= 0.0 ; i -= 0.1 ){
            i = Math.round(i*10)/10.0;
            for( var a = 0 ; a < events.length ; a++ ){
                event = events[a];
                if( contains(tv_shows,event.name) || event.name == "UNSCHEDULED" )
                    continue;
                if( event.rating == i )
                    console.log( 'moviesToSchedule.append(["' + event.name + '",' + event.duration + ',' + event.rating + ']);' );
            }
        }
    }

    for( var i = 0 ; i < schedule.length ; i++ ){
        day = schedule[i];
        for( var a = 0 ; a < day.events_morning.length ; a++ ){
            addEvent(day.events_morning[a]);
        }
        for( var b = 0 ; b < day.events_evening.length ; b++ ){
            addEvent(day.events_evening[b]);
        }
    }
    
    listEventsInOrder()
}

function contains( arr, elem ){
    for( var i = 0 ; i < arr.length ; i++ ){
        if( arr[i] == elem )
            return true;
    }
    return false;
}
</script>
</head>
<body onload="init()">
</body>
</head>